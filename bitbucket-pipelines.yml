image: python:2.7

pipelines:
  default:
    - step:
        script:
          - apt-get update --quiet
          - apt-get install --yes --quiet lsb-release
          - CLOUD_SDK_REPO="cloud-sdk-$(lsb_release -c -s)"
          - echo "deb http://packages.cloud.google.com/apt $CLOUD_SDK_REPO main" | tee /etc/apt/sources.list.d/google-cloud-sdk.list
          - curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
          - apt-get update --quiet
          - apt-get install --yes --quiet google-cloud-sdk
          # - GOOGLE_CLOUD_SDK=${HOME}/google-cloud-sdk
          # - PATH=$PATH:${GOOGLE_CLOUD_SDK}/bin
          # - echo "${PATH}" && ls ${GOOGLE_CLOUD_SDK}
          # - gcloud init
          - GAE_PYTHONPATH=${HOME}/google_appengine
          - export PYTHONPATH=${PYTHONPATH}:${GAE_PYTHONPATH}
          - python scripts/fetch_gae_sdk.py $(dirname "${GAE_PYTHONPATH}")
          - pip --quiet install -r requirements.txt -t lib/
          - echo "${PYTHONPATH}" && ls ${GAE_PYTHONPATH}
          - python test_main.py
